---
apiVersion: cr.kanister.io/v1alpha1
kind: Blueprint
metadata:
  name: rclone-hook
  namespace: kasten-io
actions:
  b2sync:
    kind: Deployment
    phases:
    - func: KubeExec
      name: sync
      args:
        namespace: "{{ .Deployment.Namespace }}"
        pod: "{{ index .Deployment.Pods 0 }}"
        container: rclone
        command:
        - "/bin/sh"
        - "-o"
        - "errexit"
        - "-o"
        - "pipefail"
        - "-c"
        - "rclone"
        - "-v"
        - "--config"
        - "/config/rclone.conf"
        - "sync"
        - "--ignore-errors"
        - "--fast-list"
        - "--b2-hard-delete"
        - "--transfers"
        - "24"
        - "--checkers"
        - "24"
        - "--bwlimit"
        - "25M"
        - "/mnt/k10-exports"
        - "b2-k10:k10-XU5jS1ot/"
